function Forum_calcActivityTime( diff, postDateTime ) {var oneMin = 60 * 1000; //One minute in millisecond = 60 Sec * 1000 Millisecond
var oneHour = oneMin * 60;var oneDay = oneHour * 24;var oneMonth = oneDay * 30;var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];if ( diff > oneMonth ) {return (monthNames[postDateTime.getMonth()]+' \''+postDateTime.getFullYear().toString().substring(2,4));} else if ( diff > oneDay ) {return (parseInt(parseFloat(diff)/oneDay) +'d');} else if ( diff > oneHour ) {return (parseInt(parseFloat(diff)/oneHour)+'h');} else if ( diff > oneMin ) {return (parseInt(parseFloat(diff)/oneMin)+'m');}
return ('Just now');}
function Forum_updateActivityDateTime( dateTime, $posts ) {dateTime = new Date(dateTime);$posts.each(function (index, post) {var $post = $(post);var postDateTime = new Date($post.data('date-time'));var diff = dateTime - postDateTime;$post.find('span').html(Forum_calcActivityTime(diff,postDateTime));});}
function Forum_froalaEditorInit( $popup, autofocus ) {$popup.find('[data-editor=froala]').each( function() {var $this     = $(this);var websiteID = $this.data('websiteId');var placeholder = $this.data('froala-placeholder') ? $this.data('froala-placeholder') : '';var buttonsList = ['clear', 'fr_separator' ,'bold', 'italic', 'underline', 'strikeThrough', 'fr_separator', 'formatOL', 'formatUL', 'fr_separator', 'insertLink', 'undo', 'redo', 'clearFormatting', 'selectAll'];$this.on('froalaEditor.initialized', function (e, editor, inputEvent) {S123.s123IconToSvg.handleFroalaIcons();});FroalaEditor.DefineIcon('clear', {NAME: 'times',template: 'font_awesome'});new FroalaEditor('#'+$this.get(0).id, {attribution: false,key: 'fIE3A-9C2C1G2B4D5A3D1ud1BI1IMNBUMRWAi1AYMSTRBUZYB-16D4E3D2E3C3I2H1B10C2B1==',fontSize: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24', '26', '28', '30', '36', '48', '60', '72', '96'],tableStyles: {'fr-no-borders': 'No Borders','fr-dashed-borders': 'Dashed Borders','fr-alternate-rows': 'Alternate Rows'},placeholderText: placeholder,saveInterval: 0,linkInsertButtons: ['linkBack'],height: $this.data('froala-height'),useClasses: true,direction: $('html').attr('dir') === 'rtl' ? 'rtl' : 'ltr',imageUploadURL: '/versions/'+$('#versionNUM').val()+'/wizard/modules/forum/froalaEditorUploadFile.php',imageUploadParams: {w: $('#w').val(),websiteID: websiteID,returnType: 'froalaEditor'},quickInsertButtons:['image','table', 'ul', 'ol', 'hr'],htmlRemoveTags: ['script', 'style', 'base', 'form', 'input', 'textarea', 'button', 'select', 'frameset', 'embed', 'object', 'param', 'iframe', 'section'],enter: FroalaEditor.ENTER_BR,pastePlain: true,toolbarSticky: false,toolbarButtonsMD: buttonsList,toolbarButtonsSM: buttonsList,toolbarButtonsXS: buttonsList,toolbarButtons: buttonsList,videoEditButtons:['videoReplace','videoRemove','videoDisplay','videoAlign','videoSize'],linkAlwaysNoFollow: true,autofocus: autofocus});});}
function Forum_setAvatar( image, imageSize, name, color ) {var $html = $('<span></span>');if ( image.length > 0 ) {$html.css('background-image','url(' + getImageWRV1(imageSize,image) + ')');if ( name.length > 0 ) {$html.attr('data-rel','tooltip');$html.attr('title',S123.escapeHtml(name));}} else {if ( name.length > 0 ) {$html.css('background-color',color);$html.attr('data-letters',S123.escapeHtml(name).charAt(0));$html.attr('data-rel','tooltip');$html.attr('title',S123.escapeHtml(name));}}
$html.addClass('avatar-img');return $html}
function Forum_getClientDetails( w, websiteID, clientID, itemUniqueID, $button, callback) {$.ajax({type: "POST",url: "/versions/"+$('#versionNUM').val()+"/wizard/modules/forum/getClientCard.php",data: 'w='+w+'&websiteID='+websiteID+'&clientID='+clientID+'&itemUniqueID='+itemUniqueID,success: function( data ) {var dataObj = jQuery.parseJSON(data);if (callback) callback.call(this,data,$button,Forum_initializePopover);}});}
function Forum_generateClientCard( data, $button, callback ) {var data = jQuery.parseJSON(data);var html = '<div class="client-card">';html += '<div class="client-card-avatar">';html += '<div class="forum-card-avatar"></div>';html += '<div class="client-card-name"><span></span></div>';html += '</div>';html += '<div class="client-card-posts">';html += '<span class="card-posts-data">'+translations.joined+' <b><span class="client-card-join"></span></b></span>';html += '<span class="card-posts-data">'+translations.posted+' <b><span class="client-card-last-post" style="display:none;"></span></b></span>';html += '<span class="card-posts-data">'+translations.forumCountOfTotalPosts.replace('{{numbers_of_posts}}','<b><span class="client-card-total-posts" style="display:none;"></span><span>')+'</span></b></span>';'+translations.countOfTotalPosts+'
html += '</div>';html += '</div>';var $html = $(html);var avatar = Forum_setAvatar(data.profileImage,400,data.nickname,data.avatarColor);var $avatar = $(avatar);$html.find('.forum-card-avatar').append($avatar);$html.find('.forum-card-avatar span').addClass('avatar-img');if ( data.nickname.length > 1 ) {$html.find('.client-card-name span').html(data.nickname);}
$html.find('.client-card-join').html(data.joined);if ( data.lastPost.length > 0 ) {$html.find('.client-card-last-post').html(data.lastPost).show();}
if ( data.totalPosts > 0 ) {$html.find('.client-card-total-posts').html(data.totalPosts).show();}
if (callback) callback.call(this,$html,$button);}
function Forum_initializePopover( html, $button ) {var $html = $(html);$button.popover({container: 'body',html: 'true',content: $html,trigger: 'manual',template: '<div class="popover client-card-popover" role="tooltip" style="max-width: 100%;"><div class="arrow"></div><div class="popover-content"></div></div>',placement: function(popover, button) {if ( isMobileDevice.any() ) return 'auto';if ( $(button).hasClass('side-menu-popover') ) {return $('html[dir=rtl]').length === 1 ? 'right' : 'left';}
return $('html[dir=rtl]').length === 1 ? 'left' : 'right';}});$button.popover('show');$button.on('shown.bs.popover', function () {$(document).on('mousedown.forumDestroyPopover', function ( event ) {if ( $(event.target).closest('.popover.share-reply').length === 0 ) {destroyClientCardPopover();}});});function destroyClientCardPopover() {$button.popover('destroy');$(document).off('mousedown.forumDestroyPopover');$(window).off('blur.forumDestroyPopover');$(window).off('scroll.forumDestroyPopover');}}
function Forum_initializeClientCard( $button, websiteID, w, itemUniqueID ) {$button.click(function() {var clientID = $(this).data('client-id');Forum_getClientDetails(w,websiteID,clientID,itemUniqueID,$button,Forum_generateClientCard);});}
function Forum_initializeSearch( $section, websiteID, itemUniqueID, searchURL, dateTime ) {var direction = $('html[dir=rtl]').length === 1 ? 'left' : 'right';var html = '<div>';html += '<form class="forum-search-box">';html += '<div class="form-group search-container">';html += '<div class="input-group">';html += '<input type="text" name="q" class="form-control forum-search-input" placeholder="'+translations.forumSearchPlaceholder+'" aria-required="true" autocomplete="off">';html += '</div>';html += '<div style="text-align:' + direction + ';">';html += '<a class="forum-search-option" href="' + searchURL + '&q=">'+translations.options+'</a>';html += '</div>';html += '</div>';html += '<input type="hidden" name="w" value="' + $('#w').val() + '">';html += '<input type="hidden" name="websiteID" value="' + websiteID + '">';html += '<input type="hidden" name="itemUniqueID" value="' + itemUniqueID + '">';html += '<input type="hidden" name="type" value="popover">';html += '</form>';html += '<div class="forum-search-loading text-center" style="display:none;">';html += S123.s123IconToSvg.getHtml('spinner','fa-spin fa-2x primary-color','');html += '</div>';html += '<div class="forum-results-container" style="display:none;"></div>';html += '</div>';var $html = $(html);var $form = $html.find('form');var $resultsContainer = $html.find('.forum-results-container');var $loading = $html.find('.forum-search-loading');var $search = $form.find('.forum-search-input');$form.submit(function(e) {e.preventDefault();});$search.on('keydown', function(event) {var eventKey = event.which;clearTimeout($search.inputFinished);$search.inputFinished = setTimeout( function() {if ( !$search.val() ) {$resultsContainer.slideUp(200).html('');return;}
$resultsContainer.slideUp(200).html('');$loading.fadeIn();Forum_search($form,$resultsContainer,$loading,searchURL,dateTime,Forum_generateSearchResult);$form.find('.forum-search-option').attr('href',searchURL+'&q='+$form.find('[name=q]').val());},500);});$section.find('.forum-search-btn').each(function(key, button){var $button = $(button);if ( isMobileDevice.any() ) {$button.attr('href',searchURL+'&q=').removeAttr('onclick');return false;}
$button.off('click').on('click', function(){var $button = $(this);$(this).popover({container: 'body',html: 'true',content: $html,trigger: 'manual',template: '<div class="popover forum-search" role="tooltip" style="max-width: 100%;"><div class="arrow hidden"></div><div class="popover-content"></div></div>',placement: function(popover, button) {return 'bottom';}});$button.popover('show');$search.focus();$button.on('shown.bs.popover', function () {$(document).on('mousedown.forumDestroyPopover', function ( event ) {if ( $(event.target).closest('.popover.forum-search').length === 0 ) {destroySearchPopover();}});});function destroySearchPopover() {$button.popover('destroy');$(document).off('mousedown.forumDestroyPopover');$(window).off('blur.forumDestroyPopover');$(window).off('scroll.forumDestroyPopover');}});});}
function Forum_search( $form, $resultsContainer, $loading, searchURL, dateTime, callback ) {$.ajax({type: "POST",url: "/versions/"+$('#versionNUM').val()+"/wizard/modules/forum/search.php",data: $form.serialize(),success: function( data ) {var dataObj = jQuery.parseJSON(data);if (callback) callback.call(this,dataObj,$resultsContainer,$loading,searchURL,dateTime);}});}
function Forum_generateSearchResult( resultsData, $resultsContainer, $loading, searchURL, dateTime ) {if ( resultsData.status == 'fail' || resultsData.length === 0 ) {var html = '<div class="text-center"><span>' + resultsData.msg + '</span></div>';var $html = $(html);$loading.fadeOut();$resultsContainer.append($html).slideDown(200);return;}
dateTime = new Date(dateTime);var index = 0;var html = '<ul class="forum-results-list">';html += '<div>';$.each(resultsData.results, function(key,data) {if ( index > 4 ) return false;index = index + 1;var createTime = new Date(data.createTime);var diff = dateTime - createTime;html += '<li>';html += '<a class="search-result background-primary-color-hover" href="'+data.url+'">';html += '<span class="result-topic">';html += '<span>' + data.subject + '</span>';if ( data.categoryName != null && data.categoryName.length > 0 ) {html += '<span>-</span>';html += '<span><b>' + data.categoryName + '</b></span>';}
html += '</span>';html += '<span class="result-body">';html += '<span>' + Forum_calcActivityTime(diff,createTime) + '</span>';html += '<span> - </span>';html += '<span>' + data.message + '</span>';html += '</span>';html += '</a>';html += '</li>';});html += '</div>';html += '</ul>';if ( index < resultsData.results.length ) {html += '<ul class="forum-more-results">';html += '<div>';html += '<li class="text-center">';html += '<a class="search-result background-primary-color-hover" href="' + searchURL + '&q=' + resultsData.query + '">'+translations.seeMore+' '+S123.s123IconToSvg.getHtml('angle-down','','')+'</a>';html += '</li>';html += '</div>';html += '</ul>';}
var $html = $(html);$resultsContainer.append($html);if ( index >= resultsData.results.length ) {$resultsContainer.find('ul.forum-results-list li:last-child').addClass('forum-last-result');}
$loading.fadeOut();$resultsContainer.slideDown(200);return;}
function Forum_getTopics( $container, websiteID, callback, itemUniqueID, hasCategories ) {$(window).scroll(function() {if($(window).scrollTop() == $(document).height() - $(window).height()) {if ( $container.data('is-loading') == 'true' ) return false;var html = '<div class="forum-load-more-loading col-xs-12 text-center">'+S123.s123IconToSvg.getHtml('spinner','fa-spin fa-4x primary-color','')+'</div>';$container.append($(html));Forum_loadTopics($container,websiteID,callback,itemUniqueID,hasCategories);}});}
function Forum_loadTopics( $container, websiteID, callback, itemUniqueID, hasCategories ) {$container.data('is-loading','true');$.ajax({type: "POST",url: "/versions/"+$('#versionNUM').val()+"/wizard/modules/forum/loadTopics.php",data: {w : $('#w').val(),websiteID : websiteID,itemUniqueID : itemUniqueID,page : $container.data('page'),categoryUniqueID : $container.data('category-id')},dataType: "json",success: function( data ) {$container.data('page',parseInt($container.data('page')) + 1);if (callback) callback.call(this,data,$container,websiteID,itemUniqueID,hasCategories);}});}
function Forum_getData( $container, $topics, w, websiteID, categoryUniqueID, hasCategories, callback ) {$.ajax({type: "POST",url: "/versions/"+$('#versionNUM').val()+"/wizard/modules/forum/getForumData.php",data: 'w='+w+'&websiteID='+websiteID+'&categoryUniqueID='+categoryUniqueID,success: function( data ) {var data = jQuery.parseJSON(data);$container.data('date-time',data.dateTime);if (callback) callback.call(this,data,$container,$topics,w,websiteID,categoryUniqueID,hasCategories);}});}
function Forum_ActiveSoftLabelInputs() {$('.newTopicForm .softLabel,#popupEditTopicReply .softLabel').each(function() {var $this = $(this);if ($this.find('input[type="text"],input[type="email"],input[type="number"]').val()!='' || typeof $this.find('input[type="text"],input[type="email"],input[type="number"]').attr('placeholder') !== 'undefined') {$this.find('label').addClass('active');}});$('.newTopicForm .softLabel > label, #popupEditTopicReply .softLabel > label').on('click',function() {var $this = $(this);$this.parents('.softLabel').find('input[type="text"],input[type="email"],input[type="number"]').trigger('focus');});$('.newTopicForm .softLabel > input[type="text"],input[type="email"],input[type="number"], #popupEditTopicReply .softLabel > input[type="text"],input[type="email"],input[type="number"]').on('focus',function() {var $this = $(this);$this.parents('.softLabel').find('label').addClass('active');});$('.newTopicForm .softLabel > input[type="text"],input[type="email"],input[type="number"], #popupEditTopicReply .softLabel > input[type="text"],input[type="email"],input[type="number"]').on('blur',function() {var $this = $(this);if ($this.val()=='' && typeof $this.attr('placeholder') === 'undefined') {$this.parents('.softLabel').find('label').removeClass('active');}});}jQuery(function($) {ForumModuleInitialize_Topics();});function ForumModuleInitialize_Topics() {$( document ).on( 's123.page.ready', function( event ) {var w = $('#w').val();var $section = $('section.s123-module-forum.forum-topics');$section.each(function( index ) {var $sectionThis = $(this);var $forumContainer = $sectionThis.find('.forum-container');var $infoBtn = $sectionThis.find('.forum-info-btn');var websiteID = $forumContainer.data('website-id');var itemUniqueID = $forumContainer.data('module-unique-id');var categoryUniqueID = $forumContainer.data('category-id') ? $forumContainer.data('category-id') : '' ;var searchURL = $forumContainer.data('search-url');var hasCategories = !jQuery.isEmptyObject($forumContainer.data('categories'));if ( $forumContainer.length > 0 ) {Forum_getData($forumContainer,$forumContainer,w,websiteID,categoryUniqueID,hasCategories,initializeForumTopics);}
Forum_initializeSearch($sectionThis,websiteID,itemUniqueID,searchURL,$forumContainer.data('date-time'));if( window.location.href.indexOf('arrange=categories') === -1 && $forumContainer.find('.topics-subject').length > 11 ) {Forum_getTopics($forumContainer,websiteID,addMoreTopics,itemUniqueID,hasCategories);}
$infoBtn.off('click').click(function(){generateForumInfoPopUp(w,websiteID,categoryUniqueID);});});});}
function addMoreTopics( data, $container, websiteID, itemUniqueID, hasCategories ) {if ( data.status == 'fail' || !data.topics || data.topics.length === 0 ) {var html = '<div class="f-search-no-result"><span><b></b></span></div>';var $html = $(html);if ( data.msg ) {$html.find('span b').html(data.msg);}
$container.append($html);$container.find('.forum-load-more-loading').remove();} else {var w = $('#w').val();var moreTopics = '<div class="moreTopics">' + data.topics + '</div>';var $moreTopics = $(moreTopics);$moreTopics.find('.forum-avatar').each(function(key,value){Forum_initializeClientCard($(value),websiteID,w,itemUniqueID);});Forum_updateActivityDateTime($container.data('date-time'),$moreTopics.find('.topic-last-activity'));Forum_getData($container,$moreTopics,w,websiteID,itemUniqueID,hasCategories,initializeMoreTopics);}}
function initializeTopics( data, $container, $moreTopics, w, websiteID, itemUniqueID, hasCategories ) {$moreTopics.find('.forum-topic').each(function(){var $topic = $(this);var $button = $topic.find('.topic-buttons-container');var $topicTitle = $container.find('.topic-title');if ( (data.loggedIn == 'true' || data.isManagment == true) && data.manager == 'true' ) {var topicID = $button.data('topic-id');var html = '<div class="btn-group">';html += '<span class="rmv-topic-btn">'+S123.s123IconToSvg.getHtml('trash','','')+'</span>';html += '</div>';$html = $(html);initializeTopicsButtons(websiteID,topicID,itemUniqueID,$html);$button.html($html).show();$container.find('.manage-topic-title').show();if ( hasCategories ) {$topicTitle.attr('class', 'topic-title col-sm-2 col-md-3');$container.find('.topics-users').attr('class', 'topics-users col-sm-1 col-md-2');;$topic.find('.forum-category').attr('class', 'forum-category hidden-xs col-sm-2');$topic.find('.topics-subject').attr('class', 'topics-subject col-xs-7 col-sm-2 col-md-3');$topicsAvatar = $topic.find('.topics-avatar-row').each(function (index, value){$value = $(value);if ( $value.hasClass('visible-xs') ) {$value.attr('class', 'topics-avatar-row visible-xs col-xs-2 col-sm-1 col-md-2');}
if ( $value.hasClass('hidden-xs') ) {$value.attr('class', 'topics-avatar-row hidden-xs col-xs-2 col-sm-1 col-md-2');}});} else {$topicTitle.attr('class', 'topic-title col-sm-4 col-md-5');$topic.find('.topics-subject').attr('class', 'topics-subject col-xs-7 col-sm-4 col-md-5');$topic.find('.topics-users').attr('class', 'topics-users col-sm-2 col-md-3');}} else if ( !hasCategories ) {$topicTitle.attr('class', 'topic-title col-sm-6');$topic.find('.topics-subject').attr('class', 'topics-subject col-xs-7 col-sm-6');}});}
function initializeMoreTopics( data, $container, $moreTopics, w, websiteID, itemUniqueID, hasCategories ) {initializeTopics(data,$container,$moreTopics,w,websiteID,itemUniqueID,hasCategories);$container.find('.forum-load-more-loading').remove();$moreTopics.find('.forum-topic').each(function(){$container.append($(this));});$container.data('is-loading','false');}
function initializeForumTopics( data, $container, $moreTopics, w, websiteID, itemUniqueID, hasCategories ) {initializeTopics(data,$container,$moreTopics,w,websiteID,itemUniqueID,hasCategories);generateAddNewTopicBtn(data,$container,$moreTopics,w,websiteID,itemUniqueID);Forum_updateActivityDateTime($container.data('date-time'),$container.find('.topic-last-activity'));$container.find('.forum-avatar').each(function(key,value){Forum_initializeClientCard($(value),websiteID,w,itemUniqueID);});}
function generateAddNewTopicBtn( data, $container, $topics, w, websiteID, itemUniqueID ) {var $newTopicBtn = $container.find('.add-new-topic-btn');var categories = $container.data('categories');var loginURL = $container.data('login-url');var categoryID = $container.data('category-id') ? $container.data('category-id') : '';if ( data.loggedIn == 'true' ) {initializeAddNewTopicBtn(websiteID,itemUniqueID,$newTopicBtn,categories,categoryID);} else {$newTopicBtn.attr('href', loginURL);}}
function initializeAddNewTopicBtn( websiteID, itemUniqueID, $button, categories, categoryID ) {var $addTopicBtn = $button;$addTopicBtn.off('click').click(function() {$.getScript('https://www.google.com/recaptcha/api.js?render=6LcICoEUAAAAAFaNA94im3FfzM5fw1b-1v2aghM7', function() {});var w = $('#w').val();buildPopup('popupNewTopic','',buildNewTopicForm(websiteID,w,itemUniqueID),'',true,false,true,'','');Forum_ActiveSoftLabelInputs();var $popup = $('#popupNewTopic');var $loading = $popup.find('#loading');generateCategoriesBox($popup,categories);if ( categoryID.length > 0 ) {$popup.find('select[name=categoryUniqueID]').val(categoryID);}
Forum_froalaEditorInit($popup,false);$popup.find('input[name=subject]').focus();$popup.find('.newTopicForm').each( function( index ) {var $form = $(this);setTimeout(function() {try {grecaptcha.ready(function() {grecaptcha.execute('6LcICoEUAAAAAFaNA94im3FfzM5fw1b-1v2aghM7', {action: 'users_forum_add_new_topic'})
.then(function(token) {$form.find('#recaptchaToken').val(token);});});} catch(err) {$form.find('#recaptchaToken').val('');}}, 50);$form.validate({errorElement: 'div',errorClass: 'help-block',focusInvalid: true,ignore: ":hidden:not(#topicMessage), [contenteditable='true']:not([name])",highlight: function (e) {$(e).closest('.form-group').removeClass('has-info').addClass('has-error');},success: function (e) {$(e).closest('.form-group').removeClass('has-error');$(e).remove();},submitHandler: function( form ) {var $form = $(form);$form.find('button:submit').prop('disabled', true);$form.hide();$loading.show();$.ajax({type: "POST",url: "/versions/"+$('#versionNUM').val()+"/wizard/modules/forum/addTopic.php",data: $form.serialize(),success: function( data ) {var dataObj = jQuery.parseJSON(data);$loading.hide();if ( dataObj.status == 'done' ) {$form.trigger("reset");buildPopup_CloseAction('popupNewTopic');if ( dataObj.url.length === 0 ) location.reload();window.location.href = dataObj.url;} else {$form.find('button:submit').prop('disabled', false);$form.show();return false;}}});}});});});}
function initializeTopicsButtons ( websiteID, topicID, itemUniqueID, $html ) {if ( !$html ) return;var $rmvTopicBtn = $html.find('.rmv-topic-btn');$rmvTopicBtn.off('click').click(function() {var w = $('#w').val();bootbox.confirm({title: '<span class="text-danger"><b>'+translations.forumDeleteTopicTitle+'</b></span>',message: translations.forumDeleteTopic,backdrop: true,buttons: {confirm: {label: translations.yes,className: 'btn-danger'},cancel: {label: translations.no,className: 'btn-default'}},callback: function( result ) {if ( !result ) return;$.ajax({type: "POST",url: "/versions/"+$('#versionNUM').val()+"/wizard/modules/forum/rmvTopic.php",data: 'w='+w+'&websiteID='+websiteID+'&uniqueID='+topicID+'&itemUniqueID='+itemUniqueID,success: function( data ) {var dataObj = jQuery.parseJSON(data);if ( dataObj.status == 'done' ) window.location.reload();}});}});});}
function buildNewTopicForm(websiteID, w, itemUniqueID) {var direction = $('html').attr('dir') === 'rtl' ? 'right' : 'left';var html = '<form class="newTopicForm" style="max-width: 700px; height: 100%;">';html += '<h1 style="color:#fff;">'+translations.forumCreateNewTopic+'</h1>';html += '<div class="row">';html += '<div class="col-xs-12">';html += '<div class="form-group softLabel">';html += '<label for="subject">'+translations.insertTopicTitle+'</label>';html += '<input type="text" name="subject" class="form-control" required data-msg-required="'+translations.jqueryValidMsgRequire+'" minlength="10" maxlength="255" data-rule-no-spaces-only="true" data-msg-no-spaces-only="'+translations.jqueryValidSpacesOnlyMsg+'">';html += '</div>';html += '</div>';html += '<div class="col-xs-12 categories-list" style="display:none;"></div>';html += '<div class="col-xs-12" style="text-align:'+direction+';">';html += '<div class="form-group softLabel">';html += '<label for="topicMessage">'+translations.insertTopicTitle+'</label>';html += '<textarea class="form-control" id="topicMessage" name="topicMessage" data-editor="froala" data-froala-height="350" data-froala-buttons="about" data-website-id="'+websiteID+'" required data-msg-required="'+translations.jqueryValidMsgRequire+'" data-rule-no-spaces-only="true" data-msg-no-spaces-only="'+translations.jqueryValidSpacesOnlyMsg+'"></textarea>';html += '</div>';html += '</div>';html += '</div>';html += '<button type="submit" class="btn btn-primary btn-block">'+translations.send+'</button>';html += '<input type="hidden" name="w" value="'+w+'">';html += '<input type="hidden" name="itemUniqueID" value="'+itemUniqueID+'">';html += '<input type="hidden" name="websiteID" value="'+websiteID+'">';html += '<input type="hidden" id="recaptchaToken" name="recaptchaToken" value=""/>';html += '</form>';html += '<div id="loading" class="text-center" style="display:none; color:#fff;">';html += S123.s123IconToSvg.getHtml('spinner','fa-spin fa-4x','background-color: #fff;');html += '</div>';return html;}
function generateCategoriesBox( $popup, categories ) {var options = '';$.each (categories, function (categoryUniqueID, category) {options += '<option value="'+categoryUniqueID+'">'+category.name+'</option>';});if ( options.length === 0 ) return;var html = '';html += '<div class="form-group softLabel">';html += '<label for="categoryUniqueID" class="active">'+translations.chooseCategory+'</label>';html += '<select class="form-control" name="categoryUniqueID" required data-msg-required="'+translations.jqueryValidMsgRequire+'">';html += options;html += '</select>';html += '</div>';$html = $(html);$popup.find('.categories-list').append($html).show();}
function generateForumInfoPopUp( w, websiteID, categoryUniqueID ) {var html = '<div class="container-fluid bg-primary">';html += '<div class="row">';html += '<div class="col-xs-12">';html += '<div class="forum-information">';html += '<div id="loading" class="text-center" style="display:none;color:#fff;">';html += S123.s123IconToSvg.getHtml('spinner','fa-spin fa-4x blue','');html += '</div>';html += '</div>';html += '</div>';html += '</div>';html += '</div>';buildPopup('popupForumInformation','',html,'',true,false,true,'','');var $popupForumInformation = $('#popupForumInformation');var $loading = $popupForumInformation.find('#loading');$.ajax({type: "POST",url: "/versions/"+$('#versionNUM').val()+"/wizard/modules/forum/getForumInfo.php",data: 'w='+w+'&websiteID='+websiteID+'&categoryUniqueID='+categoryUniqueID,beforeSend: function(){$loading.show();},complete: function(){$loading.hide();},success: function( data ) {var data = jQuery.parseJSON(data);$popupForumInformation.find('.forum-information').append($(data.info));}});}jQuery(function($) {ForumExpandedSearchInitialize();});function ForumExpandedSearchInitialize() {$( document ).on( 's123.page.ready', function( event ) {var w = $('#w').val();var $section = $('section.s123-module-forum.forum-expanded-search');$section.each(function( index ) {var $sectionThis = $(this);var $forumSearchContainer = $sectionThis.find('.forum-search-container');var $forumResultscontainer = $sectionThis.find('.forum-results-container');var $container = $sectionThis.find('.expanded-search-container');var websiteID = $container.data('website-id');var itemUniqueID = $container.data('module-unique-id');var dateTime = $container.data('date-time');$sectionThis.find('.forum-search-form').each( function( index ) {var $form = $(this);var $searchInput = $form.find('[name=q]');var $advancedSearch = $form.find('.forum-advanced-search');var $advancedSearchBtn = $form.find('.forum-advanced-search-btn');$searchInput.focus();var $datePicker = $form.find('.fake-input.forum-date-picker');var $hiddenInput = $form.find('.real-input.forum-search-date');var $datePickerIcon = $form.find('.forum-datePicker-icon');var forumSearchCalendar = new calendar_handler();forumSearchCalendar.init({$fakeInput: $datePicker,$hiddenInput: $hiddenInput,$fakeInputIcon: $datePickerIcon,type: 'datePicker',title: translations.chooseDate,calendarSettings: {format: $datePicker.data('date-format'),weekStart: 0,todayBtn: "linked",clearBtn: false,language: languageCode,todayHighlight: true},onSubmit: function( selectedDate ) {$datePicker.html(selectedDate);$hiddenInput.val(selectedDate);}});$form.validate({errorElement: 'div',errorClass: 'help-block',focusInvalid: true,ignore: "",highlight: function (e) {$(e).closest('.form-group').removeClass('has-info').addClass('has-error');},success: function (e) {$(e).closest('.form-group').removeClass('has-error');$(e).remove();},errorPlacement: function(e, element) {$(e).appendTo($(".forum-search-form-group"));},submitHandler: function( form ) {var $form = $(form);$form.find('button:submit').prop('disabled', true);$.ajax({type: "POST",url: "/versions/"+$('#versionNUM').val()+"/wizard/modules/forum/search.php",data: $form.serialize(),beforeSend: function(){$forumResultscontainer.html('');$forumSearchContainer.find('.forum-search-loading').show();},complete: function(){$forumSearchContainer.find('.forum-search-loading').hide();},success: function( data ) {var dataObj = jQuery.parseJSON(data);if ( dataObj.status == 'fail' ) {$forumResultscontainer.html('<div class="f-search-no-result"><span><b>' + dataObj.msg + '</b></span></div>').show();}
if ( dataObj.status == 'good' ) {initializeForumSearchResults(dataObj,$forumResultscontainer,dateTime);$forumResultscontainer.find('.forum-avatar').each(function(key,value){Forum_initializeClientCard($(value),websiteID,w,itemUniqueID);});$forumResultscontainer.slideDown(200);}
$form.find('button:submit').prop('disabled', false);}});return false;}});if ( $searchInput.val().length > 0 ) $form.submit();$advancedSearchBtn.off('click').on('click', function() {$advancedSearch.slideToggle('slow');return false;});});});});}
function generateForumSearchResult() {var html = '<div class="row f-search-result">';html += '<div class="col-xs-12 f-search-bottom-line">';html += '<div class="row">';html += '<div class="col-sm-1 col-xs-2">';html += '<div class="f-search-client-avatar"></div>';html += '</div>';html += '<div class="col-sm-9 col-xs-7">';html += '<div class="f-search-post-title"><a></a></div>';html += '<div class="f-search-category"><span><b></b></span></div>';html += '<div class="f-search-post-time"></div>';html += '<div class="f-search-post-message"></div>';html += '</div>';html += '</div>';html += '</div>';html += '</div>';return html;}
function initializeForumSearchResults( dataObj, $container, dateTime ) {dateTime = new Date(dateTime);var html = '<div class="f-search-header">';html += '<div class="f-search-results">';html += '<span>' + dataObj.results.length + ' ' + dataObj.msg + ' </span>';html += '<span><b>' + dataObj.query + '</b></span>';html += '</div>';html += '<div class="new-topic-btn"></div>';html += '</div>';var $html = $(html);$container.append($html);$.each(dataObj.results, function(key,result) {var html = generateForumSearchResult();var $html = $(html);$html.find('.f-search-post-title a').attr('href',result.url).html(result.subject);$html.find('.f-search-post-message').html(result.message);$html.find('.f-search-client-avatar').append(Forum_setAvatar(result.avatar[0].image,100,result.avatar[0].name,result.avatar[0].color));$html.find('.f-search-client-avatar .avatar-img').addClass('forum-avatar').attr('data-client-id',result.avatar[0].id);if ( result.categoryName != null && result.categoryName.length > 0 ) $html.find('.f-search-category span b').html(result.categoryName).show();var createTime = new Date(result.createTime);var diff = dateTime - createTime;$html.find('.f-search-post-time').data('date-time',result.createTime).html(Forum_calcActivityTime(diff,createTime));$container.append($html);});}jQuery(function($) {ForumModuleInitialize_Layout2();});function ForumModuleInitialize_Layout2() {$( document ).on( 's123.page.ready', function( event ) {var w = $('#w').val();var $section = $('section.s123-module-forum.layout-2 .forum-topics-list');$section.each(function( index ) {var $sectionThis = $(this);var $loading = $sectionThis.find('.loading');var $topFive = $sectionThis.find('.forum-top-five');var websiteID = $sectionThis.data('website-id');var uniqueID = $sectionThis.data('module-unique-id');if ( $sectionThis.length > 0 ) {$.ajax({type: "POST",url: "/versions/"+$('#versionNUM').val()+"/wizard/modules/forum/getForumTopics.php",data: 'w='+w+'&websiteID='+websiteID+'&categoryUniqueID=&uniqueID='+uniqueID,success: function( data ) {$data = $(data);$loading.hide();$section.html('').append($data.hide().fadeIn(200));}});}});});}jQuery(function($) {headersModuleInitialize_Layout();});function headersModuleInitialize_Layout() {$( document ).on( "s123.page.ready", function( event ) {var $sections = $('section.s123-module-headers:is(.layout-6,.layout-7,.layout-8,.layout-9,.layout-18,.layout-20,.layout-22,.layout-23,.layout-24,.layout-25,.layout-26,.layout-27,.layout-29,.layout-30,.layout-35,.layout-39,.layout-40)');$sections.each(function( index ) {var $s = $(this);var $carousel = $s.find('[data-ride="carousel"]');var sliderSpeed = $s.data('slider-speed');if ( sliderSpeed == '' || parseInt(sliderSpeed) < 1 || parseInt(sliderSpeed) > 21 ) {sliderSpeed = 5000;} else {sliderSpeed = parseInt(sliderSpeed) * 1000;}
$s.find('.header1, .header2').each(function( index ) {var $this = $(this);if ( $this.data('line-height') && $this.data('line-height').length > 0 ) {$this.get(0).style.setProperty('--header_line_height',$this.data('line-height'));$this.css('line-height',$this.data('line-height'));}});if( $s.hasClass('layout-20') ) {var $firstImage = $s.find('.headers-image').first();if ( $firstImage.length > 0 ) {if ( $firstImage.data('bg') !== undefined ) {var img = new Image();img.src = $firstImage.data('bg');img.onload = function() {var aspectRatio = this.width / this.height;$s.find('.headers-image').css('aspect-ratio',String(aspectRatio));if( $s.find('.headers-container').hasClass('circle-under-image') && aspectRatio < 1 ) {$s.addClass('corner-circle');}};} else {$firstImage.closest('.headers-img-wrap').addClass('circle-fixed-width');}}}
if( $s.hasClass('layout-22') || $s.hasClass('layout-29') ) {var $headersDescription = $s.find('.headers-description');var $headersimage = $s.find('.headers-image');if ( $headersimage.length == 0 ) {$headersimage = $s.find('.headers-bg-video');}
if ( $headersimage.length > 0 && $headersDescription.length > 0 ) {if ( ($headersDescription.get(0).offsetHeight - 60) > $headersimage.get(0).offsetHeight ) {$s.get(0).style.setProperty('--headers-description-height',$headersDescription.get(0).offsetHeight+'px');}}}
$carousel.carousel({interval: sliderSpeed});if( $s.hasClass('layout-26') && $s.attr('data-version') !== undefined && $s.attr('data-version') == '2' ) {if ( IsWizard() ) {$(document).on('site123.colorPicker.change',function( event ) {updateBackgroundColor();});}
updateBackgroundColor();}
function updateBackgroundColor() {var boxColorClass = $s.data('box-color');var color = $s.hasClass('bg-primary') ?getComputedStyle(document.documentElement).getPropertyValue('--modules_color_box') :getComputedStyle(document.documentElement).getPropertyValue('--modules_color_second_box');switch (boxColorClass) {case 'bg-primary-gray':color = '#ebedf0';break;case 'bg-primary-white':color = '#ffffff';break;case 'bg-primary-black':color = '#000000';break;case 'background-primary-color btn-primary-text-color':color = $s.hasClass('bg-primary') ?getComputedStyle(document.documentElement).getPropertyValue('--modules_color_section_main') :getComputedStyle(document.documentElement).getPropertyValue('--modules_color_second_section_main');break;}
$s.find('.headers-img-wrap').get(0).style.setProperty('--layout26OpacityColor',hexToRGB(color));}
function hexToRGB(hex) {var r = parseInt(hex.slice(1, 3), 16),g = parseInt(hex.slice(3, 5), 16),b = parseInt(hex.slice(5, 7), 16);return r + ", " + g + ", " + b;}
if( $s.data('image-width') == 2 ) {var sectionHeight = $s.height();$s.find('.headers-container').css('min-height',sectionHeight+'px');if( $s.hasClass('layout-22') ) {$s.find('.headers-image').css('min-height',sectionHeight+'px');}
$s.data('image-width',0);}});var $sections = $('section.s123-module-headers');$sections.each(function( index ) {var $s = $(this);$s.find('.custom-header-font').each(function( index ) {var $this = $(this);var customFont = $this.data('custom-font');if ( customFont.length > 0 ) {$this.css('font-family',customFont);}});$s.find('.header1, .header2').each(function( index ) {var $this = $(this);if( $s.hasClass('layout-7') || $s.hasClass('layout-9') || $s.hasClass('layout-22') || $s.hasClass('layout-23') || $s.hasClass('layout-24') || $s.hasClass('layout-26') || $s.hasClass('layout-27') || $s.hasClass('layout-29') || $s.hasClass('layout-33') ) {fitHeaderTextToParentContainer($this);}});function fitHeaderTextToParentContainer( $textEl ) {if ( $textEl.length == 0 ) return;fontSize = parseFloat($textEl.css('font-size'));if ( !$.isNumeric(fontSize) ) return;var $parentContainer = $textEl.closest('.headers-text-resize-container');if ( $parentContainer.length > 0 && $parentContainer.width() < $textEl.width() ) {$textEl.css('visibility','hidden');var parentContainerWidth = $parentContainer.width();if ( $textEl.closest('section').hasClass('layout-9') || $textEl.closest('section').hasClass('layout-27') ) {parentContainerWidth = parentContainerWidth + 5;}
if ( $textEl.closest('section').hasClass('layout-23') ) {parentContainerWidth = $parentContainer.innerWidth();}
var index = 0;while ( parentContainerWidth < $textEl.width() && index < 99 ) {index++;fontSize--;$textEl.get(0).style.setProperty('--header-font-size',fontSize);}
$textEl.css('visibility','unset');}}});S123_ActionButtons.init();});}jQuery(function($) {HeadersModuleInitialize_Layout5();});function HeadersModuleInitialize_Layout5() {$( document ).on( 's123.page.ready', function( event ) {var $section = $('section.s123-module-headers.layout-5');$section.each(function( index ) {var $sectionThis = $(this);var $flickityContainer = $sectionThis.find('.carousel');var originalFirstImageSize = {};if ( $flickityContainer.length === 0 ) return;$flickityContainer.flickity({imagesLoaded: true,lazyLoad: 2,pageDots: false,wrapAround: true,percentPosition: false});});});}jQuery(function($) {HeadersModuleInitialize_Layout30();});function HeadersModuleInitialize_Layout30() {$( document ).on( 's123.page.ready', function( event ) {var $section = $('section.s123-module-headers.layout-30');$section.each(function( index ) {var $sectionThis = $(this);$sectionThis.find('.contactUsForm').each( function( index ) {var $form = $(this);var customFormMultiSteps = new CustomFormMultiSteps();customFormMultiSteps.init({$form: $form,$nextButton: $form.find('.next-form-btn'),$submitButton: $form.find('.submit-form-btn'),$previousButton: $form.find('.previous-form-btn'),totalSteps: $form.find('.custom-form-steps').data('total-steps')});var forms_GoogleRecaptcha = new Forms_GoogleRecaptcha();forms_GoogleRecaptcha.init($form);$form.validate({errorElement: 'div',errorClass: 'help-block',focusInvalid: true,ignore: ':hidden:not(.custom-form-step:visible input[name^="datePicker-"])',highlight: function (e) {$(e).closest('.form-group').removeClass('has-info').addClass('has-error');},success: function (e) {$(e).closest('.form-group').removeClass('has-error');$(e).remove();},errorPlacement: function (error, element) {if( element.is('input[type=checkbox]') || element.is('input[type=radio]') ) {var controls = element.closest('div[class*="col-"]');if( controls.find(':checkbox,:radio').length > 0 ) element.closest('.form-group').append(error);else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));}
else if( element.is('.select2') ) {error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));}
else if( element.is('.chosen-select') ) {error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));}
else {error.appendTo(element.closest('.form-group'));}},submitHandler: function( form ) {var $form = $(form);var clickAction = $form.data('click-action');$form.append($('<div class="conv-code-container"></div>'));var $convCodeContainer = $form.find('.conv-code-container');var thankYouMessage = translations.ThankYouAfterSubmmit;if ( $form.data('thanks-msg') ) {thankYouMessage = $form.data('thanks-msg');}
$form.find('button:submit').prop('disabled', true);S123.ButtonLoading.start($form.find('button:submit'));var url = "/versions/"+$('#versionNUM').val()+"/include/contactO.php";if ( $form.hasClass('custom-form') || $form.hasClass('horizontal-custom-form') ) {if ( !CustomForm_IsLastStep( $form ) ) {$form.find('.next-form-btn:visible').trigger('click');S123.ButtonLoading.stop($form.find('button:submit'));$form.find('button:submit').prop('disabled', false);return false;}
if ( !CustomForm_IsFillOutAtLeastOneField($form) ) {bootbox.alert(translations.fillOutAtLeastOneField);S123.ButtonLoading.stop($form.find('button:submit'));$form.find('button:submit').prop('disabled', false);return false;}
url = "/versions/"+$('#versionNUM').val()+"/include/customFormO.php";}
if ( forms_GoogleRecaptcha.isActive && !forms_GoogleRecaptcha.isGotToken ) {forms_GoogleRecaptcha.getToken();return false;}
$.ajax({type: "POST",url: url,data: $form.serialize(),success: function( data ) {var dataObj = jQuery.parseJSON(data);$form.trigger("reset");if ( clickAction == 'thankYouMessage' || clickAction == '' ) {bootbox.alert({title: translations.sent,message: thankYouMessage+'<iframe src="/versions/'+$('#versionNUM').val()+'/include/contactSentO.php?w='+$('#w').val()+'&websiteID='+dataObj.websiteID+'&moduleID='+dataObj.moduleID+'" style="width:100%;height:30px;" frameborder="0"></iframe>',className: 'contactUsConfirm',buttons: {ok: {label: translations.Ok}},backdrop: true});} else {if ( dataObj.conv_code.length > 0 ) {var $convCode = $('<div>' + dataObj.conv_code + '</div>');$convCodeContainer.html($convCode.text());}
if( top.$('#websitePreviewIframe').length ) {bootbox.alert({title: translations.previewExternalLinkTitle,message: translations.previewExternalLinkMsg.replace('{{externalLink}}','<b>'+dataObj.action.url+'</b>'),className: 'externalAlert'});} else {window.open(dataObj.action.url,'_self');}}
customFormMultiSteps.reset();forms_GoogleRecaptcha.reset();S123.ButtonLoading.stop($form.find('button:submit'));$form.find('button:submit').prop('disabled', false);WizardNotificationUpdate();}});return false;}});$form.find('.f-b-date-timePicker').each( function() {var $option = $(this);var $datePicker = $option.find('.fake-input.date-time-picker');var $hiddenInput = $option.find('[data-id="'+$datePicker.data('related-id')+'"]');var $datePickerIcon = $option.find('.f-b-date-timePicker-icon');var formBuilderCalendar = new calendar_handler();$datePicker.data('date-format',$form.data('date-format'));formBuilderCalendar.init({$fakeInput: $datePicker,$hiddenInput: $hiddenInput,$fakeInputIcon: $datePickerIcon,type: 'datePicker',title: translations.chooseDate,calendarSettings: {format: $datePicker.data('date-format'),weekStart: 0,todayBtn: "linked",clearBtn: false,language: languageCode,todayHighlight: true},onSubmit: function( selectedDate ) {$datePicker.html(selectedDate);$hiddenInput.val(selectedDate);}});});CustomForm_DisableTwoColumns($form);});});});}